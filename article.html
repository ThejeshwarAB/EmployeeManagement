<!DOCTYPE html>
<head>
  <title>#####|ArticleTable</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/css/jquery.dataTables.css">
  <link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/css/jquery.dataTables_themeroller.css">
  <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script>
  <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/dataTables.bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href=" https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>
<!-- 
  <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.6/xlsx.full.min.js"> </script><!-- 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
   <nav class="navbar navbar-light bg-light shadow p-3 mb-5 bg-white rounded" style="padding: 15px; position: fixed; top: 0; width: 100%">
    <div class="navbar-brand mx-auto">
        <img alt="Logo" width="200" height="30" src="images/Logo.png">
        
    </div>
   <!--  <div class="d-flex justify-content-center" align="center"><img alt="Logo" width="200" height="30" src="public/images/Logo.png"></div> -->
    <!-- <span class="navbar-brand">Heading</span> -->
  </nav>
<!--   <div class="container">
    <div class="row">
  <div class="text-left"><button id="back" class="btn btn-secondary" style="margin: 15px" onclick="window.history.go(-1)">Back</button></div>
<div class="text-right"><button id="logout" class="btn btn-danger" style="margin: 15px">Logout</button></div>
</div>
</div> -->
  <div class="container" style="height: 80%;" >    
    <h3 class="text-center">Article Table</h3>
  <div class="table-responsive">
    <table class="table text-center" >
  <table id='print' class="table table-hover">
      <thead class="bg-dark text-white">
        <tr >
          <th scope="col">Article Name</th>
          <!-- <th scope="col">Employee name</th> -->
          <th scope="col">Total Pages</th>
          <th scope="col">Type of Article</th>
           <th scope="col">Vendor</th>
          <th scope="col">Blank Pages</th>
          <th scope="col">Reference</th>
          <th scope="col">Update</th> 
          <th scope="col">Delete</th> 
        </tr>
    </thead>
    <tbody id="table">
     
    </tbody>
  </table>
</table>
</div>


 <input type="file" id="fileUploader" name="fileUploader" accept=".xls, .xlsx"/><br/></br>


<div class="form-style">
      <button class="btn btn-lg btn-primary btn-block" data-toggle="modal" data-target="#exampleModalCenter" target="_blank" id="fetch" style="font-size: 0.8em;">Create Article</button>
          <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="exampleModalLongTitle">Enter the Article Detail</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
             </button>
             </div>
             <div class="modal-body" style="background-color: #D3D3D3;">
              <form class="form-style" action="/createArticle" method="POST" id="create">
              <label for="newUsername">Article Name</label>
              <!-- <input type="username" id="newUsername" name="newUsername" class="form-control" placeholder="Choose user" required autofocus ><br> -->
              <input type="text" id="Articlename" name="Articlename" class="form-control" placeholder="Article Name" required autofocus ><br>

              <!-- <select class="form-control" id="newUsername" required>
                <option value="Choose employee">Choose employee</option>
              </select><br>  -->

              <label for="pass">Total Pages</label>
              <input type="number" id="pass" name="pass" class="form-control" placeholder="Total Pages" required autofocus ><br>
              
              <label>Type of Article</label>
              <select class="form-control" id="Articletype" required>
                <option value="Choose type" disabled>Choose type</option>
                <option value="Epub 2">Epub 2</option>
                <option value="Epub 3">Epub 3</option>
                <option value="XML">XML</option>
               </select><br>   
              <label for="client">Client Name</label>
              <input type="text" id="client" name="client" class="form-control" placeholder="Client Name" required autofocus ><br>
              <div class="row">
                <div class="col-6">
              <label for="blockfile">Blank Pages</label>
              <input type="number" id="blockfile" class="form-control" placeholder="Blank Pages" required autofocus>
                </div>
                <div class="col-6">
              <label for="endingdate">Reference</label>
              <input type="text" id="reference" class="form-control"  placeholder="Reference" required autofocus>
              </div>
            </div>

              
              <br>
             
              <div class="modal-footer">
                  <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                  <button class="btn btn-primary" type="submit" name="submit">Add Article</button>
                </div>
                </form>
              </div>
            </div>
          </div>
        </div>
    </div>
    <div class="form-style">
      <div id="editModal" class="modal fade" role="dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="exampleModalLongTitle">Edit Article details</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
             </button>
             </div>
             <div class="modal-body" style="background-color: #D3D3D3;">
              <form class="form-style" action="/editArticle" method="POST" id="edit">
                <label for="editaritclename"  aria-disabled="true">Choose Article</label>
              <input type="text" id="editarticlename" name="editarticlename" class="form-control" disabled><br>
              
              <!-- <select class="form-control" id="editUsername" required>
                <option value="Choose employee" >Choose employee</option>
              </select><br>  -->

              <label for="editpass">Total pages</label>
              <input type="number" id="editpass" name="editpass" class="form-control" placeholder="Total Pages" required autofocus ><br>
              
                                
              <label>Article type</label>
              <select class="form-control" id="edittype" required>
                <option value="Choose type" disabled>Choose type</option>
                <option value="Epub 2">Epub 2</option>
                <option value="Epub 3">Epub 3</option>
                <option value="XML">XML</option>
            
              </select><br>   
                 <label for="editclient">Edit Client Name</label>
              <input type="text" id="editclient" name="editclient" class="form-control" placeholder="Edit Client Name" required autofocus ><br>
              <div class="row">
                <div class="col-6">
              <label for="editblank">Blank Pages</label>
              <input type="number" id="editblank" class="form-control" placeholder="Blank Page" required>
                </div>
                <div class="col-6">
              <label for="editref">Reference</label>
              <input type="number" id="editref" class="form-control" placeholder="Reference" required autofocus>
              </div>
            </div>

            
              <br>
             
              <div class="modal-footer">
                  <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                  <button class="btn btn-primary" type="submit" name="submit">Submit</button>
                </div>
                </form>
              </div>
            </div>
          </div>
      </div>
    </div>

</div>
</div>
<footer class="page-footer font-small bg-light shadow-sm bg-white rounded" style="position: fixed; bottom: 0; width: 100%">

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">
    <span class="material-icons" style="font-size: 15px;">call</span>
    <span>+91-44-26580262</span>
    &nbsp &nbsp
    <span class="material-icons" style="font-size: 15px;">email</span>
    <span>contact@agaramtechnologies.com</span>
  </div>
  <!-- Copyright -->

</footer>

<div class="row fixed-top col-12">
  <div class="text-left col-6"><button id="back" class="btn btn-secondary" style="margin: 15px">Back</button></div>
<div class="text-right col-6"><button id="logout" class="btn btn-danger" style="margin: 15px">Logout</button></div>

</div>
<div class="myAlert-top alert alert-success fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Success!</strong>Artical Created
</div>

<div class="mysAlert-top alert alert-success fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Successfully</strong>Artical Edited!!
</div>
<div class="msAlert-top alert  fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Successfully</strong>Artical Deleted!!
</div>
<div class="outAlert-top alert  fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Log-Out</strong>!!!
</div>
</body>
<script>

  function myAlert(){
   
    $(".myAlert-top").show();
    setTimeout(function(){
    event.preventDefault()
    $(".myAlert-top").fadeTo(0, 250).slideUp(250, function(){
      $(".myAlert-top").slideUp(250);
    })
    }, 2000);
  }

  function mysAlert(){
    //event.preventDefault()
    $(".mysAlert-top").show();
    setTimeout(function(){
    $(".mysAlert-top").fadeTo(0, 250).slideUp(250, function(){
      $(".mysAlert-top").slideUp(250);
    })
    }, 2000);
  }
  
  function msAlert(){
    //event.preventDefault()
    $(".msAlert-top").show();
    setTimeout(function(){
    $(".msAlert-top").fadeTo(0, 250).slideUp(250, function(){
      $(".msAlert-top").slideUp(250);
    })
    }, 2000);
  }
function outAlert(){
    //event.preventDefault()
    $(".outAlert-top").show();
    setTimeout(function(){
    $(".outAlert-top").fadeTo(0, 250).slideUp(250, function(){
      $(".outAlert-top").slideUp(250);
    })
    }, 2000);
  }

  var userData = []

  // var today = new Date().toISOString().substr(0, 10)
  // document.querySelector("#startDate").value = today

  // document.querySelector("#startDate").valueAsDate = new Date()

  window.onload = function(event){
    event.preventDefault()

    var url = '/fetchforarticle'
    var posting = $.post( url )
    posting.done(function(data){

      var table = document.getElementById("table")


      var works = JSON.stringify(data)
      //alert(works)

      var jsonObj = jQuery.parseJSON(works)
      //alert(jsonObj)

      for(var j = 0; j < jsonObj.length; j++)
{
        var row = table.insertRow(0);
       var cell8 = row.insertCell(0);
        var cell7 = row.insertCell(0);
        var cell6 = row.insertCell(0);
        var cell5 = row.insertCell(0);
        var cell4 = row.insertCell(0);
        var cell3 = row.insertCell(0);
        var cell2 = row.insertCell(0);
        var cell1 = row.insertCell(0);
        cell1.innerHTML = jsonObj[j]["articlename"];
        cell2.innerHTML = jsonObj[j]["TotalPass"];
        cell3.innerHTML = jsonObj[j]["articletype"];
        cell4.innerHTML = jsonObj[j]["client"];
        cell5.innerHTML = jsonObj[j]["blank"];
        cell6.innerHTML = jsonObj[j]["reference"];
        cell7.innerHTML ='<button type="button" style="background-color:transparent; border: none;" data-toggle="modal" data-target="#editModal" id="editButton"><span class="material-icons">edit</span></button>';
        cell8.innerHTML ='<button type="button" style="background-color:transparent; border: none;" class="btn btn-primary" id="deleteButton"><span class="material-icons">delete</span></button>';
}

      for(var i=0;i<data.length; i++){
        if(data[i]["adminStatus"]==false)
      {  userData.push(data["articlename"])
      }}

      $(document).ready(function() {
      $('#print').dataTable({
        "bLengthChange": false,
        "sScrollY": false,
        "scrollCollapse": false,
        "sScrollX": false,
        "iDisplayLength": 5,
        "columnDefs": [
      { "width": "10%"}],

       dom: 'Bfrtip',
        buttons: [
            'copy', 'excel', 'pdf'
        ],

      })
    })
    })

    $("#logout").click(function(event){
    event.preventDefault()
   //0 alert("You are logging out")//use Bootstrap 
   outAlert()
   setTimeout(() => { console.log("Alert called"); }, 2000);
    var posting = $.post("/logout",{})
    posting.done(function(data){
      if(data=="ok"){
      window.location.href = "/"
    }})
  })

    $("#back").click(function(event){
    event.preventDefault()
    //alert("You are logging out")//use Bootstrap alert
    var posting = $.post("/back",{})
    posting.done(function(data){
      if(data=="ok")
      window.location.href = "/admin.html"
    })
  })
  }

$("#create").submit(function(event){
    event.preventDefault()
    $('.close').click();    
    var $form = $(this),
    url = $form.attr('action')
    var posting = $.post( url, {name: $('#Articlename').val(),
                                pass: $('#pass').val(),
                                client: $('#client').val(),
                                articletype: $('#Articletype').val(),
                                blank: $('#blockfile').val(),
                                reference: $('#reference').val()} )
    posting.done(function(data){
      if(data=="ok"){
        myAlert()
        setTimeout(() => { console.log("Alert called"); }, 2000);
      //alert("Article added")
      window.location.reload()}
    })
  })




  $("#edit").submit(function(event){
    event.preventDefault()
    $('.close').click();
    var $form = $(this),
    url = $form.attr('action')
    var posting = $.post( url, {articlename: $('#editarticlename').val(),
                                pass: $('#editpass').val(),
                                client: $('#editclient').val(),
                                articletype: $('#edittype').val(),                                
                                blank: $('#editblank').val(),
                                reference: $('#editref').val()} )
    posting.done(function(data){
      if(data=="ok")
      {
      //alert("Article Edited")
      mysAlert()
      setTimeout(() => { console.log("Alert called"); }, 2000);
      window.location.reload()}
    })
  })

  $("#fetch").click(function(event){
    event.preventDefault()
    for(var i=0;i<userData.length; i++)
    $("#Articlename").append("<option value="+userData[i]+">"+userData[i]+"</option>")
  })
  $(document).on("click","button",function(){
      if(this.id=="deleteButton")
      {
      var $this = this.parentNode.parentNode.rowIndex
      var j=0
      // while(j<5){   
      //   alert(document.getElementById("print").rows[$this].cells.item(j).innerHTML)
      //   j++
      // }
      event.preventDefault()
      // var $form = $(this),
      url = '/deletearticle'
      var posting = $.post( url, {articlename: document.getElementById("print").rows[$this].cells.item(0).innerHTML,
                                  pass: document.getElementById("print").rows[$this].cells.item(1).innerHTML,
                                  articletype: document.getElementById("print").rows[$this].cells.item(2).innerHTML,     
                                  blank: document.getElementById("print").rows[$this].cells.item(3).innerHTML,
                                  reference: document.getElementById("print").rows[$this].cells.item(4).innerHTML
                                }

                
 // cell1.innerHTML = jsonObj[j]["articlename"];
 //        cell2.innerHTML = jsonObj[j]["TotalPass"];
 //        cell3.innerHTML = jsonObj[j]["articletype"];
 //        cell4.innerHTML = jsonObj[j]["client"];
 //        cell5.innerHTML = jsonObj[j]["blank"];
 //        cell6.innerHTML = jsonObj[j]["reference"];

                                   )
      posting.done(function(data){
      if(data=="ok")
      {
     // alert("Work deleted")
      msAlert()
      setTimeout(() => { console.log("Alert called"); }, 2000);
      window.location.reload()}
      })
      }
      if(this.id=="editButton")
      {
        // alert("hello")
        var $this = this.parentNode.parentNode.rowIndex
        document.getElementById('editarticlename').value = document.getElementById("print").rows[$this].cells.item(0).innerHTML
        document.getElementById('editpass').value = document.getElementById("print").rows[$this].cells.item(1).innerHTML
        document.getElementById('edittype').value = document.getElementById("print").rows[$this].cells.item(2).innerHTML
         document.getElementById('editclient').value = document.getElementById("print").rows[$this].cells.item(3).innerHTML
        document.getElementById('editblank').value = document.getElementById("print").rows[$this].cells.item(4).innerHTML
        document.getElementById('editref').value = document.getElementById("print").rows[$this].cells.item(5).innerHTML
      }
    })


 var x=[];
        $(document).ready(function(){
              $("#fileUploader").change(function(evt){
                    var selectedFile = evt.target.files[0];
                    var reader = new FileReader();
                    reader.onload = function(event) {
                      var data = event.target.result;
                      var workbook = XLSX.read(data, {
                          type: 'binary'
                      });
                      workbook.SheetNames.forEach(function(sheetName) {
                          var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                          var json_object = JSON.stringify(XL_row_object);
                          var data = jQuery.parseJSON(json_object);
                          // alert(XL_row_object);//send this
                          // alert(json_object);
                          // alert(data)
                          var url='/articlefile'
                          var posting = $.post(url,{content: json_object});
                          posting.done(function (data){ 
                            if(data=="ok")
                            {
                              window.location.reload()
                            }
                          })

                        })
                    };

                    reader.onerror = function(event) {
                      console.error("File could not be read! Code " + event.target.error.code);
                    };

                    reader.readAsBinaryString(selectedFile);
              });
        });
</script>
</html>
