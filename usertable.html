

<!DOCTYPE html>
<head>
   <title>Agaram|UserData</title>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
   <link rel="stylesheet" href="/css/bootstrap.min.css">
   <link rel="stylesheet" href="style.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
   <link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/css/jquery.dataTables.css">
   <link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/css/jquery.dataTables_themeroller.css">
   <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script>
   <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/jquery.dataTables.min.js"></script>
   <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
   <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/dataTables.bootstrap.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>
   <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
   <link rel="stylesheet" type="text/css" href=" https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
   <nav class="navbar navbar-light bg-light shadow p-3 mb-5 bg-white rounded" style="padding: 15px; position: fixed; top: 0; width: 100%">
      <div class="navbar-brand mx-auto">
         <img alt="Logo" width="200" height="30" src="images/Logo.png">
      </div>
      <!--  <div class="d-flex justify-content-center" align="center"><img alt="Logo" width="200" height="30" src="public/images/Logo.png"></div> -->
      <!-- <span class="navbar-brand">Heading</span> -->
   </nav>
   <div class="container" style="height: 80%;">
      <h3 class="text-center">Employee Table</h3>
      <div class="table-responsive">
         <table class="table text-center">
            <table id='print' class="table table-hover">
               <thead class="bg-dark text-white">
                  <tr>
                     <th scope="col">Article Assigned</th>
                     <th scope="col">Starting Page</th>
                     <th scope="col">Ending Page</th>
                     <th scope="col">Type</th>
                     <th scope="col">Work progress</th>
                     <th scope="col">Work Comments</th>
                     <th scope="col">Start Date</th>
                     <th scope="col">End Date</th>
                     <th scope="col">Update</th>
                  </tr>
               </thead>
               <tbody id="table">
               </tbody>
            </table>
         </table>
      </div>
      <div class="form-style">
         <div id="editModal" class="modal fade" role="dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
               <div class="modal-content">
                  <div class="modal-header">
                     <h5 class="modal-title" id="exampleModalLongTitle">Edit work details</h5>
                     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                     </button>
                  </div>
                  <div class="modal-body" style="background-color: #D3D3D3;">
                     <form class="form-style" action="/editProgress" method="POST" id="edit">
                        <!-- <select class="form-control" id="editUsername" required>
                           <option value="Choose employee" >Choose employee</option>
                           </select><br>  -->
                        <label for="editWork">Describe Work</label>
                        <input type="text" id="editWork" name="newPassword" class="form-control" placeholder="Describe work" disabled><br>
                        <label for="editrange">Starting Page</label>
                        <input type="text" id="editrange" name="editrange" class="form-control" placeholder="Starting Range" disabled><br>
                        <label for="endpage">Ending Page</label>
                        <input type="text" id="endpage" name="endpage" class="form-control" placeholder="End Page" disabled><br>
                        <label for="workup">Work Comments</label>
                        <input type="text" id="workup" name="workup" class="form-control" placeholder="Work Update"><br>   
                        <label>Work type</label>
                        <select class="form-control" id="editType" disabled>
                           <option value="Choose type" disabled>Choose type</option>
                           <option value="OCR">OCR</option>
                           <option value="Coding">Coding</option>
                           <option value="Image">Image</option>
                           <option value="Reference">Reference</option>
                           <option value="QC">QC</option>
                        </select>
                        <br> 
                        <p>Work status</p>
                        <select class="form-control" id="editstatus">
                           <option value="Choose type" disabled>Choose type</option>
                           <option value="Pending">Pending</option>
                           <option value="In progress">In progress</option>
                           <option value="Completed">Completed</option>
                        </select>
                        <br>
                        <div class="row">
                           <div class="col-6">
                              <label for="editstartDate">Starting date</label>
                              <input type="date" id="editstartDate" class="form-control" value="new Date()" aria-disabled="true" disabled>
                           </div>
                           <div class="col-6">
                              <label for="editendDate">Ending date</label>
                              <input type="date" id="editendDate" class="form-control" value="new Date()" aria-disabled="true" disabled>
                           </div>
                        </div>
                        <br>
                        <div class="modal-footer">
                           <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                           <button class="btn btn-primary" type="submit" name="submit">Edit progress</button>
                        </div>
                     </form>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   </div>
   <div class="row fixed-top col-12">
      <div class="text-left col-6"><button id="back" class="btn btn-secondary" style="margin: 15px">Back</button></div>
      <div class="text-right col-6"><button id="logout" class="btn btn-danger" style="margin: 15px">Logout</button></div>
   </div>
   <div class="mysAlert-top alert alert-success fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Successfully</strong>Work Edited!!
   </div>
   <div class="outAlert-top alert  fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Log-Out</strong>!!
   </div>
   <footer class="page-footer font-small bg-light shadow-sm bg-white rounded" style="position: fixed; bottom: 0; width: 100%">
      <!-- Copyright -->
      <div class="footer-copyright text-center py-3">
         <span class="material-icons" style="font-size: 15px;">call</span>
         <span>+91-44-26580262</span>
         &nbsp &nbsp
         <span class="material-icons" style="font-size: 15px;">email</span>
         <span>contact@agaramtechnologies.com</span>
      </div>
      <!-- Copyright -->
   </footer>
</body>
<script>
   function mysAlert(){
     //event.preventDefault()
     $(".mysAlert-top").show();
     setTimeout(function(){
     $(".mysAlert-top").fadeTo(0, 250).slideUp(250, function(){
       $(".mysAlert-top").slideUp(250);
     })
     }, 2000);
   }
   
   function outAlert(){
     //event.preventDefault()
     $(".outAlert-top").show();
     setTimeout(function(){
     $(".outAlert-top").fadeTo(0, 250).slideUp(250, function(){
       $(".outAlert-top").slideUp(250);
     })
     }, 2000);
   }
   window.onload = function(event){
     event.preventDefault()
     var url = '/fetchforuser'
     var posting = $.post( url )
     posting.done(function(data){
   
       var table = document.getElementById("table")
   
       for(var i = 0; i<data.length; i++){
   
         var works = JSON.stringify(data[i]["work"])
   
         var jsonObj = jQuery.parseJSON(works)
   
       for(var j = 0; j < jsonObj.length; j++)
   {
         var row = table.insertRow(0);
          var cell9 = row.insertCell(0);
          var cell8 = row.insertCell(0);
         var cell7 = row.insertCell(0);
         var cell6 = row.insertCell(0);
         var cell5 = row.insertCell(0);
         var cell4 = row.insertCell(0);
         var cell3 = row.insertCell(0);
         var cell2 = row.insertCell(0);
         var cell1 = row.insertCell(0);
         cell1.innerHTML = jsonObj[j]["desc"];
         cell2.innerHTML = jsonObj[j]["range"];
         cell3.innerHTML = jsonObj[j]["endpage"];
         cell4.innerHTML = jsonObj[j]["type"];
         cell5.innerHTML = jsonObj[j]["progress"];
         cell6.innerHTML = jsonObj[j]["workup"];
         cell7.innerHTML = jsonObj[j]["start"];
         cell8.innerHTML = jsonObj[j]["end"];
         cell9.innerHTML ='<button type="button" style="background-color:transparent; border: none;" data-toggle="modal" data-target="#editModal" id="editButton"><span class="material-icons">edit</span></button>';
   }
     }
        $(document).ready(function() {
       $('#print').dataTable({
         "bLengthChange": false,
         "iDisplayLength": 5,
         "columnDefs": [
       { "width": "10%"}],
        dom: 'Bfrtip',
         buttons: [
             'copy', 'excel', 'pdf'
         ],
   
   
       })
     })
     }) 
   }
   
   $("#logout").click(function(event){
     event.preventDefault()
   //  alert("You are logging out")//use Bootstrap alert
     outAlert()
     setTimeout(() => { console.log("Alert called"); }, 2000);
     var posting = $.post("/logout",{})
     posting.done(function(data){
       if(data=="ok")
       window.location.href = "/"
     })
   })
   
   $("#back").click(function(event){
     event.preventDefault()
     //alert("You are logging out")//use Bootstrap alert
     var posting = $.post("/back",{})
     posting.done(function(data){
       if(data=="ok")
       window.location.href = "/user.html"
     })
   })
   
   
   $("#edit").submit(function(event){
     event.preventDefault()
     var $form = $(this),
     url = $form.attr('action')
     var posting = $.post( url, {workdesc: $('#editWork').val(),
                                 worktype: $('#editType').val(),
                                 status: $('#editstatus').val(),
                                 workup: $('#workup').val(),  
                                 start: $('#editstartDate').val(),                      
                                 end: $('#editendDate').val(),
                                 endpage: $('#endpage').val()} )
     posting.done(function(data){
       if(data=="ok"){
       //alert("Work edited")
     mysAlert()
     setTimeout(() => { console.log("Alert called"); }, 2000);
     window.location.reload()}
     })
   })
   
   $(document).on("click","button",function(){
       if(this.id=="editButton")
       {
         // alert("hello")
         var $this = this.parentNode.parentNode.rowIndex
         document.getElementById('editWork').value = document.getElementById("print").rows[$this].cells.item(0).innerHTML
         document.getElementById('editrange').value = document.getElementById("print").rows[$this].cells.item(1).innerHTML
         document.getElementById('endpage').value = document.getElementById("print").rows[$this].cells.item(2).innerHTML
         document.getElementById('editType').value = document.getElementById("print").rows[$this].cells.item(3).innerHTML
         document.getElementById('editstatus').value = document.getElementById("print").rows[$this].cells.item(4).innerHTML
         document.getElementById('workup').value = document.getElementById("print").rows[$this].cells.item(5).innerHTML
         document.getElementById('editstartDate').value = document.getElementById("print").rows[$this].cells.item(6).innerHTML
         document.getElementById('editendDate').value = document.getElementById("print").rows[$this].cells.item(7).innerHTML
       }
     })
</script>
</html>

