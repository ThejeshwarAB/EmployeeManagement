

<!DOCTYPE html>
<head>
   <title>#####|AdminTable</title>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
   <link rel="stylesheet" href="/css/bootstrap.min.css">
   <link rel="stylesheet" href="style.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
   <link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/css/jquery.dataTables.css">
   <link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/css/jquery.dataTables_themeroller.css">
   <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></script>
   <script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.0/jquery.dataTables.min.js"></script>
   <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
   <script type="text/javascript" src="https://cdn.datatables.net/1.10.9/js/dataTables.bootstrap.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.6/xlsx.full.min.js"> </script>
   <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>0
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
   <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>
   <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
   <link rel="stylesheet" type="text/css" href=" https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
   <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
   <nav class="navbar navbar-light bg-light shadow p-3 mb-5 bg-white rounded" style="padding: 15px; position: fixed; top: 0; width: 100%;">
      <div class="navbar-brand mx-auto">
         <img alt="Logo" width="200" height="30" src="images/Logo.png">
      </div>
      <!--  <div class="d-flex justify-content-center" align="center"><img alt="Logo" width="200" height="30" src="public/images/Logo.png"></div> -->
      <!-- <span class="navbar-brand">Heading</span> -->
   </nav>
   <!--   <div class="container">
      <div class="row">
      <div class="text-left"><button id="back" class="btn btn-secondary" style="margin: 15px" onclick="window.history.go(-1)">Back</button></div>
      <div class="text-right"><button id="logout" class="btn btn-danger" style="margin: 15px">Logout</button></div>
      </div>
      </div> -->
   <div class="container" style="height: 80%; ">
      <h3 class="text-center">Employee Assignment</h3>
      <div class="table-responsive">
         <table class="table text-center">
            <table id='print' class="table table-hover" >
               <thead class="bg-dark text-white">
                  <tr  style="text-align: center; font-size: 11px;"  >
                     <th  scope="col">Employee Name</th>
                     <th scope="col">Article Name</th>
                     <th scope="col">Starting Page</th>
                     <th scope="col">Ending Page</th>
                     <th scope="col">Work Status</th>
                     <th scope="col">Work Comments</th>
                     <th scope="col">Work Type</th>
                     <th scope="col">Start date</th>
                     <th scope="col">End date</th>
                     <th scope="col">Update</th>
                     <th scope="col">Delete</th>
                  </tr>
               </thead>
               <tbody id="table">
               </tbody>
            </table>
         </table>
      </div>
      <input type="file" id="fileUploader" name="fileUploader" accept=".xls, .xlsx"/><br/></br>
      <div class="form-style">
         <button class="btn btn-lg btn-primary btn-block" data-toggle="modal" data-target="#exampleModalCenter" target="_blank" id="fetch" style="font-size: 0.8em;">Create work</button>
         <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
               <div class="modal-content">
                  <div class="modal-header">
                     <h5 class="modal-title" id="exampleModalLongTitle">Enter work details</h5>
                     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                     </button>
                  </div>
                  <div class="modal-body" style="background-color: #D3D3D3;">
                     <form class="form-style" action="/createWork" method="POST" id="create">
                        <label for="newUsername">Choose employee</label>
                        <!-- <input type="username" id="newUsername" name="newUsername" class="form-control" placeholder="Choose user" required autofocus ><br> -->
                        <select class="form-control" id="newUsername" required>
                           <option value="Choose employee" disabled>Choose employee</option>
                        </select>
                        <br> 
                        <label for="newWork">Choose Artical</label>
                        <select class="form-control" id="newWork" required>
                           <option value="Choose Article" disabled>Choose the Article</option>
                        </select>
                        <br> 
                        <!--  <label for="newWork" class="sr-only">Work description</label>
                           <input type="text" id="newWork" name="newPassword" class="form-control" placeholder="Describe work" required autofocus ><br>
                            -->
                        <label for="range">Starting Page</label>
                        <input type="number" id="range" name="range" class="form-control" placeholder="Starting Page" required autofocus ><br>
                        <label for="range">Ending Page</label>
                        <input type="number" id="endpage" name="endpage" class="form-control" placeholder="Ending Page" required autofocus ><br>
                        <label for="newType">
                           Work Type</p>
                           <select class="form-control" id="newType" required>
                              <option value="Choose type" disabled>Choose type</option>
                              <option value="OCR">OCR</option>
                              <option value="Coding">Coding</option>
                              <option value="Image">Image</option>
                              <option value="Reference">Reference</option>
                              <option value="QC">QC</option>
                           </select>
                           <br>   
                           <div class="row">
                              <div class="col-6">
                        <label for="startingdate">Starting date</label>
                        <input type="date" id="startDate" class="form-control" value="new Date()" placeholder="dd-mm-yyyy" required autofocus>
                        </div>
                        <div class="col-6">
                        <label for="endingdate">Ending date</label>
                        <input type="date" id="endDate" class="form-control" value="new Date()" placeholder="dd-mm-yyyy" required autofocus>
                        </div>
                        </div>
                        <br>
                        <div class="modal-footer">
                           <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                           <button class="btn btn-primary" type="submit" name="submit">Add work</button>
                        </div>
                     </form>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div class="form-style">
         <div id="editModal" class="modal fade" role="dialog" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
               <div class="modal-content">
                  <div class="modal-header">
                     <h5 class="modal-title" id="exampleModalLongTitle">Edit work details</h5>
                     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                     </button>
                  </div>
                  <div class="modal-body" style="background-color: #D3D3D3;">
                     <form class="form-style" action="/editWork" method="POST" id="edit">
                        <label for="editUsername" aria-disabled="true">Choose employee</label>
                        <input type="username" id="editUsername" name="editUsername" class="form-control" disabled><br>
                        <!-- <select class="form-control" id="editUsername" required>
                           <option value="Choose employee" >Choose employee</option>
                           </select><br>  -->
                        <label for="editWork">Work description</label>
                        <input type="text" id="editWork" name="newPassword" class="form-control" placeholder="Edit Article" required autofocus disabled><br>
                        <label for="editrange" >Edit Start Page</label>
                        <input type="text" id="editrange" name="editrange" class="form-control" placeholder="Edit Starting Page" required autofocus ><br>
                        <label for="editend">Edit End Page</label>
                        <input type="number" id="editend" name="editend" class="form-control" placeholder="Edit Ending Range" required autofocus ><br>  
                        <label for ="ediType">Work type</label>
                        <select class="form-control" id="editType" required>
                           <option value="Choose type" disabled>Choose type</option>
                           <option value="OCR">OCR</option>
                           <option value="Coding">Coding</option>
                           <option value="Image">Image</option>
                           <option value="Reference">Reference</option>
                           <option value="QC">QC</option>
                        </select>
                        <br>   
                        <div class="row">
                           <div class="col-6">
                              <label for="editstartDate">Starting date</label>
                              <input type="date" id="editstartDate" class="form-control" value="new Date()" aria-disabled="true" disabled>
                           </div>
                           <div class="col-6">
                              <label for="editendDate">Ending date</label>
                              <input type="date" id="editendDate" class="form-control" placeholder="" required autofocus>
                           </div>
                        </div>
                        <br>
                        <div class="modal-footer">
                           <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                           <button class="btn btn-primary" type="submit" name="submit">Edit work</button>
                        </div>
                     </form>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   </div>
   <!-- Footer -->
   <footer class="page-footer font-small bg-light shadow-sm bg-white rounded" style="position: fixed; bottom: 0; width: 100%">
      <!-- Copyright -->
      <div class="footer-copyright text-center py-3">
         <span class="material-icons" style="font-size: 15px;">call</span>
         <span>+91-44-26580262</span>
         &nbsp &nbsp
         <span class="material-icons" style="font-size: 15px;">email</span>
         <span>contact@agaramtechnologies.com</span>
      </div>
      <!-- Copyright -->
   </footer>
   <div class="row fixed-top col-12">
      <div class="text-left col-6"><button id="back" class="btn btn-secondary" style="margin: 15px">Back</button></div>
      <div class="text-right col-6"><button id="logout" class="btn btn-danger" style="margin: 15px">Logout</button></div>
   </div>
   </div>
   <div class="myAlert-top alert alert-success fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Successfully</strong>Work Created
   </div>
   <div class="mysAlert-top alert alert-success fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Successfully</strong>Work Edited
   </div>
   <div class="msAlert-top alert  fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Successfully</strong>Work Deleted
   </div>
   <div class="outAlert-top alert fixed-top" style="display:none; margin: 25px; left: 25%;  width: 50%;">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Logout</strong>!!
   </div>
</body>
<script>
   function myAlert(){
       //event.preventDefault()
       $(".myAlert-top").show();
       setTimeout(function(){
       $(".myAlert-top").fadeTo(0, 250).slideUp(250, function(){
         $(".myAlert-top").slideUp(250);
       })
       }, 2000);
     }
   
     function mysAlert(){
       //event.preventDefault()
       $(".mysAlert-top").show();
       setTimeout(function(){
       $(".mysAlert-top").fadeTo(0, 250).slideUp(250, function(){
         $(".mysAlert-top").slideUp(250);
       })
       }, 2000);
     }
     
     function msAlert(){
       //event.preventDefault()
       $(".msAlert-top").show();
       setTimeout(function(){
       $(".msAlert-top").fadeTo(0, 250).slideUp(250, function(){
         $(".msAlert-top").slideUp(250);
       })
       }, 2000);
     }
   function outAlert(){
       //event.preventDefault()
       $(".outAlert-top").show();
       setTimeout(function(){
       $(".outAlert-top").fadeTo(0, 250).slideUp(250, function(){
         $(".outAlert-top").slideUp(250);
       })
       }, 2000);
     }
   
     var userData = []
     var article =[]
     var userDataFlag=0
     var articleFlag=0
     // var today = new Date().toISOString().substr(0, 10)
     // document.querySelector("#startDate").value = today
   
     // document.querySelector("#startDate").valueAsDate = new Date()
   
     window.onload = function(event){
       event.preventDefault()
       userDataFlag=0
       articleFlag=0
       var url = '/fetchforadmin'
       var posting = $.post( url )
       posting.done(function(data){
           for(var i = 0 ; i < data.length; i++){
           if(data[i]["articlename"]==null)
           {
             userData.push(data[i]["username"])
           }
           if(data[i]["articlestatus"]==true)
           {
             article.push(data[i]["articlename"])
           }
         }
         var table = document.getElementById("table")
         for(var i = 0; i<data.length; i++){
           var works = JSON.stringify(data[i]["work"])
           var jsonObj = jQuery.parseJSON(works)
            if(data[i]["articlestatus"]==false){
         for(var j = 0; j < jsonObj.length ; j++)
         {
           var row = table.insertRow(0);
           var cell11=row.insertCell(0);
           var cell10=row.insertCell(0);
           var cell9=row.insertCell(0);
           var cell8=row.insertCell(0);
           var cell7 = row.insertCell(0);
           var cell6 = row.insertCell(0);
           var cell5 = row.insertCell(0);
           var cell4 = row.insertCell(0);
           var cell3 = row.insertCell(0);
           var cell2 = row.insertCell(0);
           var cell1 = row.insertCell(0);
           cell1.innerHTML = data[i]["username"];
           cell2.innerHTML = jsonObj[j]["desc"];
           cell3.innerHTML = jsonObj[j]["range"];
           cell4.innerHTML = jsonObj[j]["endpage"];
           cell5.innerHTML = jsonObj[j]["progress"];
           cell6.innerHTML = jsonObj[j]["workup"];
           cell7.innerHTML = jsonObj[j]["type"];
           cell8.innerHTML = jsonObj[j]["start"];
           cell9.innerHTML = jsonObj[j]["end"];
           cell10.innerHTML ='<button type="button" style="background-color:transparent; border: none;" data-toggle="modal" data-target="#editModal" id="editButton"><span class="material-icons">edit</span></button>';
           cell11.innerHTML ='<button type="button" style="background-color:transparent; border: none;" class="btn btn-primary" id="deleteButton"><span class="material-icons">delete</span></button>';
          }
       }}
   
         $(document).ready(function() {
         $('#print').dataTable({
           "bLengthChange": false,
           "iDisplayLength": 5,
           "columnDefs": [
         { "width": "10%"}],
   
   dom: 'Bfrtip',
           buttons: [
               'copy', 'excel', 'pdf'
           ],
   
   
   
         })
       })
     })
   
       $("#logout").click(function(event){
       event.preventDefault()
       outAlert()
       //alert("You are logging out")//use Bootstrap alert
       var posting = $.post("/logout",{})
       posting.done(function(data){
         if(data=="ok")
         window.location.href = "/"
       })
     })
   
     $("#back").click(function(event){
       event.preventDefault()
       //alert("You are logging out")//use Bootstrap alert
       var posting = $.post("/back",{})
       posting.done(function(data){
         if(data=="ok")
         window.location.href = "/admin.html"
       })
     })
   
     }
   
     $("#create").submit(function(event){
       event.preventDefault()
       $('.close').click();      // auto close on submit  #sai,tamil
       var $form = $(this),
       url = $form.attr('action')
       var posting = $.post( url, {user: $('#newUsername').val(),
                                   workdesc: $('#newWork').val(),
                                   worktype: $('#newType').val(),
                                   range: $('#range').val(),
                                   endpage: $('#endpage').val(),
                                   start: $('#startDate').val(),
                                   end: $('#endDate').val()} )
       posting.done(function(data){
         if(data=="ok")
          myAlert()
        setTimeout(() => { console.log("Alert called"); }, 2000);
       //  alert("Work added")
         window.location.reload()
       })
     })
   
     $("#edit").submit(function(event){
       event.preventDefault()
       $('.close').click();
       var $form = $(this),
       url = $form.attr('action')
       var posting = $.post( url, {user: $('#editUsername').val(),
                                   workdesc: $('#editWork').val(),
                                   worktype: $('#editType').val(),
                                   range :$('#editrange').val(),
                                   endpage:$('#editend').val(),                               
                                   end: $('#editendDate').val()} )
       posting.done(function(data){
         if(data=="ok"){
        // alert("Work edited")
         mysAlert()
         setTimeout(() => { console.log("Alert called"); }, 2000);
         window.location.reload()
       }
       })
     })
   
     $("#fetch").click(function(event){
       event.preventDefault()
       for(var i=0;i<userData.length; i++){
        if(userDataFlag<userData.length){
         $("#newUsername").append("<option value="+userData[i]+">"+userData[i]+"</option>")
         userDataFlag++}}
   
        for(var i=0;i<article.length; i++){
          if(articleFlag<article.length){
           $("#newWork").append("<option value="+article[i]+">"+article[i]+"</option>")
           articleFlag++}
          }
   
   
     })
     $(document).on("click","button",function(){
         if(this.id=="deleteButton")
         {
         var $this = this.parentNode.parentNode.rowIndex
         var j=0
         // while(j<5){   
         //   alert(document.getElementById("print").rows[$this].cells.item(j).innerHTML)
         //   j++
         // }
         event.preventDefault()
         // var $form = $(this),
         url = '/deleteWork'
         var posting = $.post( url, {user: document.getElementById("print").rows[$this].cells.item(0).innerHTML,
                                     workdesc: document.getElementById("print").rows[$this].cells.item(1).innerHTML,
                                     worktype: document.getElementById("print").rows[$this].cells.item(2).innerHTML,
                                     end: document.getElementById("print").rows[$this].cells.item(3).innerHTML} )
         posting.done(function(data){
         if(data=="ok"){
           msAlert()
           setTimeout(() => { console.log("Alert called"); }, 2000);
         // alert("Work deleted")
         window.location.reload()
       }
         })
         }
         if(this.id=="editButton")
         {
           // alert("hello")
           var $this = this.parentNode.parentNode.rowIndex
           document.getElementById('editUsername').value = document.getElementById("print").rows[$this].cells.item(0).innerHTML
           document.getElementById('editWork').value = document.getElementById("print").rows[$this].cells.item(1).innerHTML
            document.getElementById('editrange').value = document.getElementById("print").rows[$this].cells.item(2).innerHTML
             document.getElementById('editend').value = document.getElementById("print").rows[$this].cells.item(3).innerHTML
             document.getElementById('editType').value = document.getElementById("print").rows[$this].cells.item(6).innerHTML
           document.getElementById('editstartDate').value = document.getElementById("print").rows[$this].cells.item(7).innerHTML
           document.getElementById('editendDate').value = document.getElementById("print").rows[$this].cells.item(8).innerHTML
          
         }
       })
   
         
   
          var x=[];
           $(document).ready(function(){
                 $("#fileUploader").change(function(evt){
                       var selectedFile = evt.target.files[0];
                       var reader = new FileReader();
                       reader.onload = function(event) {
                         var data = event.target.result;
                         var workbook = XLSX.read(data, {
                             type: 'binary'
                         });
                         workbook.SheetNames.forEach(function(sheetName) {
                             var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                             var json_object = JSON.stringify(XL_row_object);
                             var data = jQuery.parseJSON(json_object);
                             // alert(XL_row_object);//send this
                             // alert(json_object);
                             // alert(data)
                             var url='/workfile'
                             var posting = $.post(url,{content: json_object});
                             posting.done(function (data){ 
                               if(data=="ok"){
                              window.location.reload()
                               }
                             })
   
                           })
                       };
   
                       reader.onerror = function(event) {
                         console.error("File could not be read! Code " + event.target.error.code);
                       };
   
                       reader.readAsBinaryString(selectedFile);
                 });
           });
</script>
</html>

